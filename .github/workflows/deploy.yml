name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]  # å½“æ¨é€åˆ°mainåˆ†æ”¯æ—¶è§¦å‘

# æ·»åŠ å·¥ä½œæµæƒé™
permissions:
  contents: write  # å…è®¸å†™å…¥ä»“åº“å†…å®¹
  pages: write     # å…è®¸æ“ä½œGitHub Pages
  id-token: write  # å…è®¸ç”ŸæˆIDä»¤ç‰Œç”¨äºèº«ä»½éªŒè¯

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # æ£€å‡ºä»£ç 
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # è·å–å®Œæ•´çš„æäº¤å†å²

      # è®¾ç½®Node.jsç¯å¢ƒ
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'  # ä½¿ç”¨Node.js 20ç‰ˆæœ¬
          cache: 'npm'  # ç¼“å­˜npmä¾èµ–ä»¥åŠ å¿«æ„å»ºé€Ÿåº¦

      # å®‰è£…ä¾èµ–
      - name: Install dependencies
        run: npm ci  # ä½¿ç”¨ciå‘½ä»¤ç¡®ä¿ä¾èµ–ä¸€è‡´æ€§

      # æ„å»ºé¡¹ç›®
      - name: Build
        run: npm run build  # æ‰§è¡Œæ„å»ºå‘½ä»¤

      # æ£€æŸ¥æ„å»ºç»“æœ
      - name: Check build output
        run: |
          echo "æ„å»ºè¾“å‡ºç›®å½•ç»“æ„ï¼š"
          ls -la dist/
          echo "æ£€æŸ¥.nojekyllæ–‡ä»¶ï¼š"
          if [ -f dist/.nojekyll ]; then
            echo ".nojekyllæ–‡ä»¶å­˜åœ¨"
          else
            echo ".nojekyllæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸­..."
            touch dist/.nojekyll
            echo ".nojekyllæ–‡ä»¶å·²åˆ›å»º"
          fi

      # éƒ¨ç½²åˆ°GitHub Pages
      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: dist  # æ„å»ºè¾“å‡ºç›®å½•
          branch: gh-pages  # éƒ¨ç½²åˆ°gh-pagesåˆ†æ”¯
          clean: true  # æ¸…ç†æ—§æ–‡ä»¶
          # ä½¿ç”¨GITHUB_TOKENè¿›è¡Œèº«ä»½éªŒè¯
          token: ${{ secrets.GITHUB_TOKEN }}
          # éƒ¨ç½²åˆ°æ ¹ç›®å½•ï¼Œç¡®ä¿ä¸vite.config.jsä¸­çš„baseé…ç½®åŒ¹é…
          target-folder: /  # éƒ¨ç½²åˆ°gh-pagesåˆ†æ”¯çš„æ ¹ç›®å½•
          # è®¾ç½®Gitæäº¤ä¿¡æ¯
          git-config-name: GitHub Actions
          git-config-email: github-actions@github.com
          # æ·»åŠ æäº¤ä¿¡æ¯
          commit-message: "Deploy from GitHub Actions - ${{ github.sha }}"

      # è¾“å‡ºéƒ¨ç½²ä¿¡æ¯
      - name: Deployment Info
        run: |
          echo "ğŸš€ éƒ¨ç½²å®Œæˆï¼"
          echo "ğŸ“¦ ä»“åº“: ${{ github.repository }}"
          echo "ğŸŒ GitHub Pages URL: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
          echo "ğŸ“‹ æ„å»ºæäº¤: ${{ github.sha }}"